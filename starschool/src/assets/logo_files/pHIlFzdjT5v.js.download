;/*FB_PKG_DELIM*/

__d("LSHandleMessageRestoreResponse",["LSArrayGetObjectAt","LSDecryptMessages","LSDeleteBackupOnClient","LSIsEncryptionVersionSecure","LSIssueNewEbTaskAndGetTaskIDV2","LSIssuePointQueryRestoreTask","LSLoadThreadPkFromThreadId","LSLogMebClientEvent.nop","LSLogWebQpl.nop","LSRestoreEchoBlobs.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][handleMessageRestoreResponse] Beginning execution."),d[1]=c.i64.of_float(Date.now()),a[7]?(d[11]="handleMessageRestoreResponse was called with instructions to delete the user's EB client state",function(a){c.logger(a).info(a)}(["[EncryptedBackups][handleMessageRestoreResponse] ","",d[11]].join("")),d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"handleMessageRestoreResponse",[d[11]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(e){return d[2]=a[5].get("request_id"),a[5],d[3]=c.i64.of_int32(a[0].length),d[2]!==void 0?c.nativeOperation(b("LSLogWebQpl.nop"),d[2],c.i64.cast([0,521476165]),"call_from_client",d[3],void 0,void 0):c.resolve()},function(b){return c.i64.neq(a[6],void 0)?c.sequence([function(b){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(b,e){var f=b.done;b=b.value;return f?d[11]=!1:(e=b.item,d[14]=e.deviceId,c.i64.neq(d[14],void 0)?d[13]=c.i64.neq(d[14],a[6]):d[13]=!1,d[11]=d[13])})},function(a){return d[4]=d[11]}]):c.resolve(d[4]=!1)},function(e){return d[4]?c.sequence([function(a){return d[11]="Exiting early due to EBDevice ID mismatch",function(a){c.logger(a).info(a)}(["[EncryptedBackups][handleMessageRestoreResponse] ","",d[11]].join("")),d[12]=c.createArray(),void 0!==void 0?d[14]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"handleMessageRestoreResponse",[d[11]].join(""),d[12],c.i64.cast([0,4]))},function(a){return d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,110])),d[13].set("stored_procedure","LSEncryptedBackupsHandleMessageRestoreResponseStoredProcedure"),d[13].set("error_message",""),c.resolve()}]):c.sequence([function(b){return d[11]=a[5].get("reference_timestamp"),a[5],d[12]=a[5].get("request_id"),a[5],d[13]=a[5].get("restore_task_source"),a[5],c.i64.neq(a[6],void 0)?c.sequence([function(b){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(b,e){var f=b.done;b=b.value;return f?d[20]=!1:(e=b.item,d[23]=e.deviceId,c.i64.neq(d[23],void 0)?d[22]=c.i64.neq(d[23],a[6]):d[22]=!1,d[20]=d[22])})},function(a){return d[14]=d[20]}]):c.resolve(d[14]=!1)},function(e){return d[14]?c.resolve((d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,110])),d[20].set("stored_procedure","LSEncryptedBackupsHandleMessageRestoreResponseStoredProcedure"),d[20].set("error_message",""),d[15]=d[20])):c.sequence([function(e){return d[20]=c.i64.of_int32(a[0].length),d[12]!==void 0?c.nativeOperation(b("LSLogWebQpl.nop"),d[12],c.i64.cast([0,521476165]),"decryption_start",d[20],d[13],void 0):c.resolve()},function(e){return c.storedProcedure(b("LSDecryptMessages"),a[0],a[2]).then(function(a){return a=a,d[21]=a[0],d[22]=a[1],a})},function(e){return d[21]!==void 0?c.sequence([function(e){return c.storedProcedure(b("LSLoadThreadPkFromThreadId"),a[2]).then(function(a){return a=a,d[24]=a[0],d[25]=a[1],a})},function(e){return c.i64.neq(d[24],void 0)?c.sequence([function(e){return d[27]=c.i64.of_int32(a[0].length),d[12]!==void 0?c.nativeOperation(b("LSLogWebQpl.nop"),d[12],c.i64.cast([0,521476165]),"decryption_success",d[27],d[13],void 0):c.resolve()},function(e){return void 0!==void 0?c.resolve(d[28]=void 0):c.sequence([function(a){return d[29]=c.createArray(),d[30]=c.i64.of_int32(d[21].length),c.i64.gt(d[30],c.i64.cast([0,0]))?c.loopAsync(d[30],function(a){return d[39]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[21],d[39]).then(function(a){return a=a,d[40]=a[0],d[41]=a[1],a})},function(a){return d[42]=d[40].get("value"),d[40],d[43]=(d[29].push(d[42]),d[29])}])}):c.resolve()},function(e){return d[31]=a[1].get("has_more_before"),a[1],d[32]=a[1].get("next_message_timestamp_ms_before"),a[1],d[33]=a[1].get("has_more_after"),a[1],d[34]=a[1].get("next_message_timestamp_ms_after"),a[1],c.nativeOperation(b("LSRestoreEchoBlobs.nop"),d[24],d[29],d[31],d[32],d[33],d[34],a[4],a[2],d[12],d[11],d[13]).then(function(a){return a=a,d[35]=a[0],d[36]=a[1],d[37]=a[2],a})},function(e){return a[7]?c.storedProcedure(b("LSDeleteBackupOnClient"),void 0,void 0,!0,d[12],void 0,!0):c.resolve()},function(e){return d[35]?c.sequence([function(e){return d[39]=c.i64.of_int32(d[37].length),d[40]=c.i64.of_int32(d[36].length),c.i64.eq(d[40],d[39])?c.sequence([function(e){return d[42]=c.i64.cast([0,0]),d[43]=c.i64.of_int32(d[37].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(e){return d[44]=e,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[37],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[36],d[42]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(e){return c.storedProcedure(b("LSIssuePointQueryRestoreTask"),a[2],d[47],d[45],void 0,c.i64.cast([0,35])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[42]=c.i64.add(d[42],c.i64.cast([0,1]))}])}):c.resolve()},function(a){return d[41]=void 0}]):c.resolve((d[42]=new c.Map(),d[42].set("error_code",c.i64.cast([0,106])),d[42].set("stored_procedure","LSEncryptedBackupsHandleMessageRestoreResponseStoredProcedure"),d[42].set("error_message",""),d[41]=d[42]))},function(a){return d[38]=void 0}]):c.resolve((d[39]=new c.Map(),d[39].set("error_code",c.i64.cast([0,105])),d[39].set("stored_procedure","LSEncryptedBackupsHandleMessageRestoreResponseStoredProcedure"),d[39].set("error_message",""),d[38]=d[39]))},function(a){return d[28]=d[38]}])},function(a){return d[26]=d[28]}]):c.resolve(d[26]=d[25])},function(a){return d[23]=d[26]}]):c.resolve((d[22]!==void 0?(d[24]=d[22].get("error_code"),d[22],c.i64.eq(d[24],c.i64.cast([0,1]))?0:0):0,d[23]=d[22]))},function(a){return d[15]=d[23]}])},function(e){return d[15]!==void 0?c.sequence([function(a){return c.resolve()},function(e){return d[20]=c.i64.of_int32(a[0].length),d[12]!==void 0?c.nativeOperation(b("LSLogWebQpl.nop"),d[12],c.i64.cast([0,521476165]),"decryption_fail",d[20],d[13],!1):c.resolve()},function(e){return a[7]?c.storedProcedure(b("LSDeleteBackupOnClient"),void 0,void 0,!0,d[12],void 0,!0):c.resolve()},function(e){return d[21]=d[15].get("error_code"),d[15],d[22]=d[15].get("stored_procedure"),d[15],d[23]=a[5].get("restore_operation_type"),a[5],d[24]=d[15].get("error_message"),d[15],c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?d[25]=void 0:(e=a.item,c.sequence([function(a){return d[45]=e.deviceId,d[44]=e.backupTenancy,d[43]=e.encryptionVersion,d[38]=void 0,c.i64.neq(d[38],void 0)?c.resolve(d[39]=d[38]):c.sequence([function(a){return d[46]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[56]=(d[46].push(c.i64.cast([0,0])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]?d[56]=(d[46].push(c.i64.cast([0,2])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[56]=(d[46].push(c.i64.cast([0,3])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[56]=(d[46].push(c.i64.cast([0,4])),d[46]):0,d[51]=c.createArray(),d[52]=c.i64.of_int32(d[46].length),c.i64.gt(d[52],c.i64.cast([0,0]))?c.loopAsync(d[52],function(a){return d[56]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],d[56]).then(function(a){return a=a,d[57]=a[0],d[58]=a[1],a})},function(a){return d[59]=(d[51].push(d[57]),d[51])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[56]=c.createArray(),d[57]=c.i64.of_int32(d[51].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.loopAsync(d[57],function(a){return d[59]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[51],d[59]).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],a})},function(a){return d[62]=(d[56].push(c.i64.to_string(d[60])),d[56])}])}):c.resolve()},function(a){return d[58]=d[56].join(","),d[53]=d[58]}])},function(a){return d[51].some(function(a){return c.i64.eq(d[43],a)})?d[54]=d[43]:d[54]=void 0,c.i64.neq(d[54],void 0)?d[55]=d[54]:d[55]=void 0,d[39]=d[55]}])},function(a){return c.i64.neq(d[39],void 0)?d[40]=d[39]:d[40]=c.i64.cast([0,0]),c.i64.neq(d[44],void 0)?d[41]=d[44]:d[41]=c.i64.cast([0,1]),c.i64.neq(d[45],void 0)?d[42]=d[45]:d[42]=void 0,d[25]=d[42]}]))})},function(e){return d[27]=new c.Map(),d[27].set("error_code",d[21]),d[27].set("error_message",d[24]==null?"":d[24]),d[27].set("stored_procedure",d[22]),d[28]=new c.Map(),d[28].set("act_thread_id",a[2]),d[28].set("source",d[13]),d[28].set("restore_operation_type",d[23]),d[28].set("request_id",d[12]),d[28].set("device_id",d[25]),d[29]=new c.Map(),d[29].set("restore_context",d[28]),d[29].set("failure",d[27]),d[30]=d[29].get("queue_name"),d[29],d[30]!==void 0?d[31]=d[30]:(d[38]=d[29].get("restore_context"),d[29],d[39]=d[38].get("act_thread_id"),d[38],d[31]=["encrypted_backups_restore",":",d[39]].join("")),d[32]=c.toJSON(d[29]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),d[31],c.i64.cast([0,50030]),d[32],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[33]=a[0],a})},function(b){return d[34]=a[5].get("restore_operation_type"),a[5],d[35]=d[15].get("error_code"),d[15],d[36]=d[15].get("error_code"),d[15],d[37]=" ",d[16]=["Failed (",d[37],c.i64.to_string(d[36]),d[37],")"].join("")}]):c.sequence([function(a){return c.resolve()},function(b){return d[20]=a[5].get("restore_operation_type"),a[5],d[16]="Succeeded"}])},function(e){return d[17]="",d[18]=["Message Restore Status: ",d[17],d[16],d[17],". ACT Thread ID: ",d[17],a[2]].join(""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][handleMessageRestoreResponse] ","",d[18]].join("")),d[19]=c.createArray(),void 0!==void 0?d[20]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"handleMessageRestoreResponse",[d[18]].join(""),d[19],c.i64.cast([0,4]))}])},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][handleMessageRestoreResponse] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"handleMessageRestoreResponse",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleMessageRestoreResponseStoredProcedure";e.exports=a}),null);
__d("XCometGroupMembersExpertsControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/groups/{idorvanity}/members/experts/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);